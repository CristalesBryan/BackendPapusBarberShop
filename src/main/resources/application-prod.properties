# ===========================================
# CONFIGURACIÓN DE PRODUCCIÓN PARA RAILWAY
# PAPUS BARBERSHOP
# ===========================================
# Este archivo se carga automáticamente cuando:
# spring.profiles.active=prod
# O cuando se ejecuta con: -Dspring.profiles.active=prod
#
# IMPORTANTE: Esta configuración está diseñada SOLO para Railway.
# No incluye valores por defecto para localhost.

# ==================== CONFIGURACIÓN DEL SERVIDOR ====================
# Puerto del servidor (Railway proporciona la variable PORT automáticamente)
server.port=${PORT}

# ==================== CONFIGURACIÓN DE BASE DE DATOS ====================
# Railway proporciona DATABASE_URL en formato: postgresql://user:pass@host:port/db
# DatabaseConfig.java parsea automáticamente esta URL y configura HikariPool
# Las variables PGUSER y PGPASSWORD son opcionales si DATABASE_URL contiene credenciales
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${PGUSER:}
spring.datasource.password=${PGPASSWORD:}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==================== CONFIGURACIÓN DE POOL DE CONEXIONES HIKARI ====================
# Configuración optimizada para producción en Railway
# DatabaseConfig.java configura estos valores programáticamente, pero estos son los defaults
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name=PapusBarberShopPool-Prod
spring.datasource.hikari.leak-detection-threshold=60000

# ==================== CONFIGURACIÓN JPA/HIBERNATE ====================
# En producción, NO usar 'update', usar 'validate' o 'none'
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.show-sql=false

# ==================== CONFIGURACIÓN DE LOGGING ====================
# Logging optimizado para producción (menos verboso)
logging.level.com.papusbarbershop=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN

# Logs DEBUG de HikariCP para validar la conexión en producción
logging.level.com.zaxxer.hikari=DEBUG
logging.level.com.zaxxer.hikari.HikariConfig=DEBUG
logging.level.com.zaxxer.hikari.pool.HikariPool=DEBUG

# ==================== CONFIGURACIÓN DE VALIDACIÓN ====================
# En producción, ser más estricto con las validaciones
spring.jackson.deserialization.fail-on-unknown-properties=true

# ==================== CONFIGURACIÓN DE SEGURIDAD ====================
# Deshabilitar endpoints de desarrollo en producción
# (Asegúrate de que /admin/reset-admin-password esté protegido o deshabilitado)

# ==================== CONFIGURACIÓN JWT ====================
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# ==================== CONFIGURACIÓN DE AWS S3 ====================
# Configuración de S3 para almacenamiento de imágenes
# Las credenciales se obtienen de variables de entorno en Railway
# IMPORTANTE: Configura estas variables en Railway:
# - AWS_ACCESS_KEY_ID: Tu Access Key ID de AWS IAM
# - AWS_SECRET_ACCESS_KEY: Tu Secret Access Key de AWS IAM
# - AWS_REGION: Región de tu bucket S3 (ej: us-east-2)
# - AWS_S3_BUCKET: Nombre de tu bucket S3 (también acepta AWS_S3_BUCKET_NAME)
aws.s3.region=${AWS_REGION:us-east-2}
# Soporta tanto AWS_S3_BUCKET como AWS_S3_BUCKET_NAME para compatibilidad
aws.s3.bucket-name=${AWS_S3_BUCKET:${AWS_S3_BUCKET_NAME:papus-barbershop-images}}
aws.s3.access-key-id=${AWS_ACCESS_KEY_ID}
aws.s3.secret-access-key=${AWS_SECRET_ACCESS_KEY}
# Tiempo de expiración para URLs presignadas (en segundos)
# 604800 = 7 días (recomendado para imágenes públicas en Vista-Clientes)
# Esto permite que las imágenes se muestren durante una semana sin necesidad de regenerar URLs
aws.s3.presigned-url-expiration=604800

# ==================== CONFIGURACIÓN DE ACTUATOR ====================
# Spring Boot Actuator para health checks y monitoreo
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized
management.health.db.enabled=true
